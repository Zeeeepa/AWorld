# FROM ghcr.io/open-webui/open-webui:main as base
FROM ghcr.io/open-webui/open-webui:main as base

RUN mkdir /app/aworld

RUN apt-get update && apt-get install -y wget unzip openssh-client procps nodejs npm

ARG PIP_OPTIONS='-i https://mirrors.aliyun.com/pypi/simple/'

# Install Chrome Driver
RUN cd /app/aworld/ && \
    wget https://storage.googleapis.com/chrome-for-testing-public/136.0.7103.92/linux64/chromedriver-linux64.zip && \
    unzip chromedriver-linux64.zip && \
    rm chromedriver-linux64.zip
ENV CHROME_DRIVER_PATH=/app/aworld/chromedriver-linux64/chromedriver

# Config Env
RUN npx playwright install chrome

# Install AWorld Dependencies
COPY ./aworld/requirements.txt /app/aworld/aworld/requirements.txt
RUN pip install -r /app/aworld/aworld/requirements.txt ${PIP_OPTIONS}

COPY ./examples/gaia/requirements.txt /app/aworld/examples/gaia/requirements.txt
# Install Gaia
RUN pip install -r /app/aworld/examples/gaia/requirements.txt ${PIP_OPTIONS}

FROM base as runner

COPY . /app/aworld

# Create GAIA benchmark directory
RUN mkdir -p /app/aworld/gaia-benchmark/fs && \
    mkdir -p /app/aworld/gaia-benchmark/logs && \
    mkdir -p /app/aworld/static

ENV HF_HUB_OFFLINE=1
ENV ENABLE_OLLAMA_API=False
ENV ENABLE_OPENAI_API=False
ENV ENABLE_DIRECT_CONNECTIONS=False
ENV ENABLE_EVALUATION_ARENA_MODELS=False
ENV ENABLE_TITLE_GENERATION=False
ENV ENABLE_AUTOCOMPLETE_GENERATION=False
ENV ENABLE_TAGS_GENERATION=False
